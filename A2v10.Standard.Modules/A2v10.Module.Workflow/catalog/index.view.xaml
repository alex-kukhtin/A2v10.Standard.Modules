<Page xmlns="clr-namespace:A2v10.Xaml;assembly=A2v10.Xaml"
	  Title="@[Catalog]">
	<Page.CollectionView>
		<CollectionView ItemsSource="{Bind Workflows}" RunAt="ServerUrl">

		</CollectionView>
	</Page.CollectionView>
	<Grid Rows="Auto,1*,Auto" Height="100%">
		<Toolbar>
			<Button Icon="Add" Content="@[Create]" Command="{BindCmd Open, Argument=0, Url='/$workflow/catalog/edit'}"/>
			<Button Icon="Edit" Command="{BindCmd OpenSelected, Argument={Bind Parent.ItemsSource}, Url='/$workflow/catalog/edit'}"/>
			<Separator />
			<Button Icon="Upgrade" Content="@[WfAdm.Publish]" 
				Command="{BindCmd ExecuteSelected, CommandName=publish, Argument={Bind Workflows}}"/>
			<Button Icon="PlayOutline" Content="@[WfAdm.Run]" Command="{BindCmd ExecuteSelected, CommandName=start, Argument={Bind Workflows}}"/>
			<!--
			<Button Icon="Upload2" Content="Upload" Command="{BindCmd Execute, CommandName=upload}"/>
			-->
			<Separator />
			<Button Icon="Reload" Command="{BindCmd Reload}"/>
		</Toolbar>
		<DataGrid Grid.Row="2" Grid.Col="1" Mark="{Bind $Mark}" MarkerStyle="Row"
				ItemsSource="{Bind Parent.ItemsSource}" FixedHeader="True"
				DoubleClick="{BindCmd OpenSelected, Argument={Bind Parent.ItemsSource}, Url='/$workflow/catalog/edit'}">
			<DataGridColumn Header="@[Id]" Content="{Bind Id}" Wrap="NoWrap" Fit="True"/>
			<DataGridColumn Header="@[Name]">
				<Popover Text="{Bind Name}" ShowOnHover="True" Background="White"
						 Placement="RightBottom" Underline="Disable">
					<StackPanel Padding="1rem">
						<Html Content="{Bind Svg}" CssClass="z-5"/>
					</StackPanel>
				</Popover>
			</DataGridColumn>
			<DataGridColumn Content="{Bind DateCreated, DataType=DateTime}" Header="@[Created]" />
			<DataGridColumn Content="{BindNumber Version}" Header="@[Version]" Role="Number"/>
			<DataGridColumn Content="{Bind Memo}" LineClamp="2"/>
			<DataGridColumn Content="{Bind NeedPublish}" />
		</DataGrid>
	</Grid>

	<InlineDialog Id="args" Title="Workflow Arguments" Width="20rem" Padding="0,0,2rem,0">
		<InlineDialog.Buttons>
			<Button Style="Primary" Content="@[Ok]" Command="{BindCmdExec startWorkflow, Argument={Bind Workflows.$selected}}"/>
			<Button Content="@[Close]" Command="{BindCmd Close}"/>
		</InlineDialog.Buttons>
		<Slot Scope="{Bind Workflows.$selected}">
			<Grid Height="100%" Columns="1*, Auto" AlignItems="Bottom">
				<Repeater ItemsSource="{Bind Arguments}">
					<Group>
						<TextBox Label="{Bind Name}" Value="{Bind Value}"/>
						<Label Content="{Bind Type}" Margin="14,0,0,0"/>
					</Group>
				</Repeater>
			</Grid>
		</Slot>
	</InlineDialog>
</Page>